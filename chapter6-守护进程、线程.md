# chapter6-守护进程、线程

## 会话

会话:多个进程组的集合

创建会话的 6 点注意事项:

1. 调用进程不能是进程组组长，该进程变成新会话首进程
2. 该进程成为一个新进程组的组长进程
3. 需要 root 权限(ubuntu 不需要)
4. 新会话丢弃原有的控制终端，该会话没有控制终端（意思是适合在后台中运行）
5. 该调用进程是组长进程，则出错返回
6.  建立新会话时，先调用 fork，父进程终止，子进程调用 setsid

相关函数：

**getsid(),setsid()函数**

注意事项：进程id，进程组id，会话id三者合一，是一样的

getsid 函数:
 pid_t getsid(pid_t pid) 获取当前进程的会话 id 成功返回调用进程会话 ID，失败返回-1，设置 error

setsid 函数:
 pid_t setsid(void) 创建一个会话，并以自己的 ID 设置进程组 ID，同时也是新会话的 ID 成功返回调用进程的会话 ID，失败返回-1，设置 error

示例代码：scesion.c:

```c
```

## 守护进程

Daemon(精灵)进程，是 Linux 中的后台服务进程，通常独立于控制终端并且周期性地执行某种任务或等待处理某些发生的事件。一般采用以 d 结尾的名字。

Linux 后台的一些系统服务进程，没有控制终端，**不能直接和用户交互**。不受用户登录、注销的影响，一直在 运行着，他们都是守护进程。如:预读入缓输出机制的实现;ftp 服务器;nfs 服务器等。

创建守护进程，最关键的一步是调用 setsid 函数创建一个新的 Session，并成为 Session Leader。