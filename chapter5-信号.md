# 信号

## 概念

1. 简单
2. 携带相对简单的信息
3. 满足**某个特定条件**才能发动

 信号的特质：

软件层面上的“中断”，一旦信号产生，程序必须立刻停止运行，处理信号，处理结束再执行后续指令，每个进程收到的所有信号，都是由内核负责发送的，内核处理。

## 与信号相关的事件和状态

- 产生信号:
  1. 按键产生，如:Ctrl+c、Ctrl+z、Ctrl+\
  2. 系统调用产生，如:kill、raise、abort
  3. 软件条件产生，如:定时器 alarm，如sleep函数就是借助这个来实现的
  4. 硬件异常产生，如:非法访问内存(段错误)、除 0(浮点数例外)、内存对齐出错(总线错误) 
  5. 命令产生，如:kill 命令

- 递达：内核产生信号并送达进程
- 未决：产生和递达之间的状态。主要由于阻塞(屏蔽)导致该状态
- 处理信号：
  1. 执行默认动作
  2. 忽略处理，处于已经递达状态
  3. 捕捉（调用用户处理函数） 
- 阻塞信号集(信号屏蔽字): 
  - 本质为位图，将某些信号加入集合，对他们设置屏蔽，当屏蔽某个信号后，再收到该信号，该信号的处理将推后，描述该信号的位在设置屏蔽后，会翻转为 1，表示信号处于阻塞状态。
- 未决信号集
  1. 信号产生，未决信号集中描述该信号的位立刻翻转为 1，表信号处于未决状态。当信号被处理对应位翻转回为0。这一时刻往往非常短暂。
  2. 信号产生后由于某些原因(主要是阻塞)不能抵达。这类信号的集合称之为未决信号集。在屏蔽解除前， 信号一直处于未决状态。

Linux 内核的进程控制块 PCB 是一个结构体，`task_struct`, 除了包含进程 id，状态，工作目录，用户 id，组 id， 文件描述符表，还包含了信号相关的信息，主要指**阻塞信号集**和**未决信号集**，两个的本质都是位图。

## 常规信号

```bash
kill -l # 查看信号
```

不存在编号为 0 的信号。其中 1-31 号信号称之为常规信号(也叫普通信号或标准信号)，34-64 称之为实时信 号，驱动编程与硬件相关。名字上区别不大。而前 32 个名字各不相同。

## 信号4要素

信号编号，信号名称，信号事件，默认处理动作

可通过 man 7 signal 查看帮助文档获取，重点掌握前20个